# Phase 2: Sophia AI Cleanup Proposal

## Executive Summary

Based on the Phase 1 scan, we've identified **853 items** totaling **779.31 MB** (8.31 MB cruft + 771 MB large files) that can be safely cleaned from the repository.

## Scan Results Overview

| Category | Items | Size | Risk Level | Action |
|----------|-------|------|------------|--------|
| Backup Files (*.pyc) | 778 | 8.31 MB | âœ… Low | Delete |
| Large Archive Files | 2 | 771 MB | âœ… Low | Delete |
| MCP Duplicates | 2 | 30 KB | âš ï¸ Medium | Verify & Delete |
| Env Leaks | 71 | ~200 KB | ðŸš¨ High | Review & Redact |
| **Total** | **853** | **779.31 MB** | - | - |

## Detailed Recommendations

### 1. ðŸŸ¢ Backup Files (*.pyc) - SAFE TO DELETE
- **778 Python cache files** across all directories
- These are automatically regenerated by Python
- **Recommendation**: Delete all immediately
- **Impact**: Zero - Python recreates these as needed

### 2. ðŸŸ¢ Large Archive Files - SAFE TO DELETE
Found 2 large tar.gz files:
- `sophia-backend.tar.gz` (750.2 MB)
- `sophia-frontend.tar.gz` (20.8 MB)

**Recommendation**: Delete both files
- These appear to be old deployment archives
- Code is in Git, no need for tar backups
- **Recovery**: Can recreate from Git history if needed

### 3. ðŸŸ¡ MCP Server Duplicates - VERIFY FIRST
Found 2 servers marked as removed:
- `mcp-servers/unified_ai` (empty directory)
- `mcp-servers/portkey_admin` (30.5 KB)

**Recommendation**: 
1. Verify these aren't running: `docker ps | grep -E "unified_ai|portkey_admin"`
2. Check K8s: `kubectl get pods -A | grep -E "unified_ai|portkey_admin"`
3. If not running, delete both directories

### 4. ðŸ”´ Environment Leaks - MANUAL REVIEW REQUIRED
Found **71 files** with potential secrets:
- `.env` files and templates
- Configuration files with hardcoded values
- Scripts with embedded credentials

**High Priority Files**:
- `lambda_inference.env`
- `vercel-env-bulk-import.env`
- `.env.template`
- `.env.example`

**Recommendation**:
1. Review each file manually
2. For templates: Replace actual values with placeholders
3. For active configs: Move to Pulumi ESC
4. Delete any files with real secrets after migration

## Phased Execution Plan

### Phase 2A: Safe Deletions (Immediate)
```bash
# Delete all Python cache files
find . -name "*.pyc" -delete
find . -name "__pycache__" -type d -empty -delete

# Delete large archives (after backup confirmation)
rm -f sophia-backend.tar.gz sophia-frontend.tar.gz
```

### Phase 2B: MCP Cleanup (After Verification)
```bash
# Check if servers are running
docker ps | grep -E "unified_ai|portkey_admin"
kubectl get pods -A | grep -E "unified_ai|portkey_admin"

# If not running, delete
rm -rf mcp-servers/unified_ai
rm -rf mcp-servers/portkey_admin
```

### Phase 2C: Secret Remediation (Manual)
1. Audit each of the 71 files
2. Create redacted versions for templates
3. Update documentation to use Pulumi ESC
4. Delete files with real secrets

## Risk Mitigation

### Before Execution:
1. **Full Backup**: 
   ```bash
   git branch cleanup-backup-$(date +%Y%m%d)
   git push origin cleanup-backup-$(date +%Y%m%d)
   ```

2. **Verify Git Status**:
   ```bash
   git status
   git stash save "Pre-cleanup backup"
   ```

### During Execution:
- Run enhanced cleanup script with `DRY_RUN=false`
- Monitor Slack alerts
- Check application health after each phase

### Rollback Plan:
```bash
# If issues arise
git checkout cleanup-backup-$(date +%Y%m%d)
git stash pop  # Restore any uncommitted changes
```

## Expected Outcomes

### Immediate Benefits:
- **779.31 MB** freed from repository
- **853 files** removed reducing clutter
- Faster Git operations (clone, fetch, push)
- Cleaner repository structure

### Security Benefits:
- Elimination of 71 potential secret leaks
- Reduced attack surface
- Compliance with security best practices

### Development Benefits:
- Faster searches and navigation
- No confusion from duplicate MCP servers
- Clear separation of active vs archived code

## Automated Prevention

After cleanup, the enhanced daily cleanup script will:
- Automatically remove *.pyc files daily
- Flag large files > 10MB
- Detect new .env files
- Monitor for MCP duplicates
- Send Slack alerts for issues

## Next Steps

1. **Review this proposal** with the team
2. **Execute Phase 2A** (safe deletions) immediately
3. **Verify and execute Phase 2B** (MCP cleanup)
4. **Schedule Phase 2C** (secret remediation) with security team
5. **Deploy GitHub Action** for automated daily cleanup

## Metrics for Success

- Repository size reduction: **>20%** âœ… (779MB reduction)
- File count reduction: **>10%** âœ… (853 files)
- Zero secret leaks after remediation
- Zero production impact
- Automated prevention deployed

---

**Recommendation**: Proceed with Phase 2A immediately, followed by 2B after verification, and schedule 2C for thorough secret remediation. 