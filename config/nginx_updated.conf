
# Updated nginx configuration with fixed ports
upstream ai_core_services {
    server 192.222.58.232:8001;  # vector_search_mcp
    server 192.222.58.232:8002;  # real_time_chat_mcp
    server 192.222.58.232:8101;  # ai_memory_mcp (updated port)
}

upstream business_services {
    server 104.171.202.117:8110;  # gong_mcp
    server 104.171.202.117:8111;  # hubspot_mcp
    server 104.171.202.117:8112;  # linear_mcp
    server 104.171.202.117:8113;  # asana_mcp
}

server {
    listen 80;
    listen 443 ssl;
    server_name sophia-ai.com;
    
    # SSL configuration (to be updated with Let's Encrypt)
    ssl_certificate /etc/ssl/certs/sophia-ai.crt;
    ssl_certificate_key /etc/ssl/private/sophia-ai.key;
    
    location /api/ai/ {
        proxy_pass http://ai_core_services;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        health_check interval=30s fails=3 passes=2;
    }
    
    location /api/business/ {
        proxy_pass http://business_services;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        health_check interval=30s fails=3 passes=2;
    }
}
