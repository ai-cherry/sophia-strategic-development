{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "version": "2.0",
  "metadata": {
    "name": "Sophia AI CEO Dashboard",
    "description": "Executive dashboard for real-time business intelligence",
    "author": "Sophia AI Team",
    "createdAt": "2024-01-20",
    "theme": "dark"
  },
  "resources": [
    {
      "id": "snowflake_db",
      "type": "snowflake",
      "name": "Snowflake Data Warehouse",
      "config": {
        "account": "{{ environment.SNOWFLAKE_ACCOUNT }}",
        "username": "{{ environment.SNOWFLAKE_USERNAME }}",
        "password": "{{ environment.SNOWFLAKE_PASSWORD }}",
        "warehouse": "COMPUTE_WH",
        "database": "SOPHIA_AI",
        "schema": "BUSINESS_INTELLIGENCE"
      }
    },
    {
      "id": "sophia_api",
      "type": "restapi",
      "name": "Sophia AI Backend",
      "config": {
        "baseURL": "{{ environment.API_BASE_URL }}/api/v1",
        "headers": {
          "Authorization": "Bearer {{ localStorage.values.authToken }}",
          "Content-Type": "application/json"
        },
        "timeout": 30000
      }
    },
    {
      "id": "gong_api",
      "type": "restapi",
      "name": "Gong Integration",
      "config": {
        "baseURL": "https://api.gong.io/v2",
        "headers": {
          "Authorization": "Bearer {{ environment.GONG_API_KEY }}"
        }
      }
    }
  ],
  "queries": [
    {
      "id": "getClientHealth",
      "resource": "sophia_api",
      "type": "GET",
      "endpoint": "/executive/client-health",
      "transformer": "return formatDataAsArray(data.clients)"
    },
    {
      "id": "getRevenueMetrics",
      "resource": "snowflake_db",
      "query": "SELECT DATE_TRUNC('month', date) as month, SUM(revenue) as total_revenue, SUM(mrr) as mrr, COUNT(DISTINCT client_id) as active_clients FROM revenue_metrics WHERE date >= DATEADD('month', -12, CURRENT_DATE()) GROUP BY 1 ORDER BY 1",
      "trigger": "onLoad"
    },
    {
      "id": "getRecentCalls",
      "resource": "gong_api",
      "type": "GET",
      "endpoint": "/calls?fromDateTime={{ moment().subtract(7, 'days').toISOString() }}&limit=50",
      "transformer": "return data.calls.map(call => ({ id: call.id, title: call.title, duration: call.duration, score: call.score, participants: call.participants }))"
    },
    {
      "id": "strategicChat",
      "resource": "sophia_api",
      "type": "POST",
      "endpoint": "/executive/strategic-chat",
      "body": {
        "message": "{{ chatInput.value }}",
        "context": {
          "selectedClient": "{{ clientSelector.value }}",
          "dateRange": "{{ dateRangePicker.value }}"
        }
      },
      "runWhenModelUpdates": ["chatInput.value"]
    }
  ],
  "components": [
    {
      "id": "mainContainer",
      "type": "container",
      "properties": {
        "backgroundColor": "#0f0f0f",
        "padding": "24px"
      },
      "children": [
        {
          "id": "header",
          "type": "container",
          "properties": {
            "direction": "row",
            "justifyContent": "space-between",
            "marginBottom": "24px"
          },
          "children": [
            {
              "id": "title",
              "type": "text",
              "properties": {
                "value": "CEO Strategic Intelligence Dashboard",
                "size": "h1",
                "color": "#ffffff",
                "weight": "bold"
              }
            },
            {
              "id": "refreshButton",
              "type": "button",
              "properties": {
                "text": "Refresh Data",
                "style": "outline",
                "color": "primary",
                "onClick": "{{ utils.refreshQueries() }}"
              }
            }
          ]
        },
        {
          "id": "tabContainer",
          "type": "tabs",
          "properties": {
            "defaultTab": "overview"
          },
          "tabs": [
            {
              "id": "overview",
              "label": "Strategic Overview",
              "components": [
                {
                  "id": "metricsRow",
                  "type": "container",
                  "properties": {
                    "direction": "row",
                    "gap": "16px",
                    "marginBottom": "24px"
                  },
                  "children": [
                    {
                      "id": "revenueCard",
                      "type": "statistic",
                      "properties": {
                        "label": "Monthly Revenue",
                        "value": "{{ utils.formatCurrency(getRevenueMetrics.data[getRevenueMetrics.data.length - 1]?.total_revenue || 0) }}",
                        "trend": "{{ utils.calculateTrend(getRevenueMetrics.data) }}",
                        "backgroundColor": "#1a1a1a",
                        "borderColor": "#2a2a2a"
                      }
                    },
                    {
                      "id": "mrrCard",
                      "type": "statistic",
                      "properties": {
                        "label": "MRR",
                        "value": "{{ utils.formatCurrency(getRevenueMetrics.data[getRevenueMetrics.data.length - 1]?.mrr || 0) }}",
                        "backgroundColor": "#1a1a1a",
                        "borderColor": "#2a2a2a"
                      }
                    },
                    {
                      "id": "clientsCard",
                      "type": "statistic",
                      "properties": {
                        "label": "Active Clients",
                        "value": "{{ getRevenueMetrics.data[getRevenueMetrics.data.length - 1]?.active_clients || 0 }}",
                        "backgroundColor": "#1a1a1a",
                        "borderColor": "#2a2a2a"
                      }
                    }
                  ]
                },
                {
                  "id": "chartsRow",
                  "type": "container",
                  "properties": {
                    "direction": "row",
                    "gap": "16px"
                  },
                  "children": [
                    {
                      "id": "revenueChart",
                      "type": "chart",
                      "properties": {
                        "title": "Revenue Trend",
                        "type": "line",
                        "data": "{{ getRevenueMetrics.data }}",
                        "x": "month",
                        "y": ["total_revenue", "mrr"],
                        "backgroundColor": "#1a1a1a",
                        "gridColor": "#2a2a2a",
                        "width": "60%"
                      }
                    },
                    {
                      "id": "clientHealthTable",
                      "type": "table",
                      "properties": {
                        "title": "Client Health Portfolio",
                        "data": "{{ getClientHealth.data }}",
                        "columns": [
                          {
                            "key": "name",
                            "label": "Client",
                            "width": "30%"
                          },
                          {
                            "key": "health_score",
                            "label": "Health",
                            "width": "20%",
                            "render": "{{ utils.renderHealthScore(item) }}"
                          },
                          {
                            "key": "mrr",
                            "label": "MRR",
                            "width": "25%",
                            "format": "currency"
                          },
                          {
                            "key": "risk_factors",
                            "label": "Risks",
                            "width": "25%",
                            "render": "{{ utils.renderRiskBadges(item.risk_factors) }}"
                          }
                        ],
                        "backgroundColor": "#1a1a1a",
                        "width": "40%"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "id": "strategic_chat",
              "label": "Strategic Chat",
              "components": [
                {
                  "id": "chatContainer",
                  "type": "container",
                  "properties": {
                    "backgroundColor": "#1a1a1a",
                    "padding": "20px",
                    "borderRadius": "8px"
                  },
                  "children": [
                    {
                      "id": "chatHistory",
                      "type": "listView",
                      "properties": {
                        "data": "{{ chatMessages.value }}",
                        "height": "400px",
                        "itemTemplate": {
                          "type": "container",
                          "properties": {
                            "padding": "12px",
                            "marginBottom": "8px",
                            "backgroundColor": "{{ item.role === 'user' ? '#2a2a2a' : '#1f1f1f' }}",
                            "borderRadius": "6px"
                          },
                          "children": [
                            {
                              "type": "text",
                              "properties": {
                                "value": "{{ item.role === 'user' ? 'You' : 'Sophia AI' }}",
                                "weight": "bold",
                                "size": "small",
                                "color": "#888"
                              }
                            },
                            {
                              "type": "text",
                              "properties": {
                                "value": "{{ item.content }}",
                                "color": "#ffffff"
                              }
                            }
                          ]
                        }
                      }
                    },
                    {
                      "id": "chatInputContainer",
                      "type": "container",
                      "properties": {
                        "direction": "row",
                        "gap": "12px",
                        "marginTop": "16px"
                      },
                      "children": [
                        {
                          "id": "chatInput",
                          "type": "textInput",
                          "properties": {
                            "placeholder": "Ask about revenue, clients, or business insights...",
                            "width": "85%"
                          }
                        },
                        {
                          "id": "sendButton",
                          "type": "button",
                          "properties": {
                            "text": "Send",
                            "color": "primary",
                            "width": "15%",
                            "onClick": "{{ strategicChat.trigger() }}"
                          }
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "id": "ai_insights",
              "label": "AI Insights",
              "components": [
                {
                  "id": "insightsGrid",
                  "type": "grid",
                  "properties": {
                    "columns": 2,
                    "gap": "16px"
                  },
                  "children": [
                    {
                      "id": "callInsights",
                      "type": "card",
                      "properties": {
                        "title": "Recent Call Analysis",
                        "backgroundColor": "#1a1a1a"
                      },
                      "children": [
                        {
                          "type": "listView",
                          "properties": {
                            "data": "{{ getRecentCalls.data.slice(0, 5) }}",
                            "itemTemplate": {
                              "type": "container",
                              "children": [
                                {
                                  "type": "text",
                                  "properties": {
                                    "value": "{{ item.title }}",
                                    "weight": "medium"
                                  }
                                },
                                {
                                  "type": "text",
                                  "properties": {
                                    "value": "Score: {{ item.score }}/100 â€¢ Duration: {{ utils.formatDuration(item.duration) }}",
                                    "size": "small",
                                    "color": "#888"
                                  }
                                }
                              ]
                            }
                          }
                        }
                      ]
                    },
                    {
                      "id": "actionItems",
                      "type": "card",
                      "properties": {
                        "title": "Recommended Actions",
                        "backgroundColor": "#1a1a1a"
                      },
                      "children": [
                        {
                          "type": "listView",
                          "properties": {
                            "data": "{{ utils.generateActionItems(getClientHealth.data, getRecentCalls.data) }}",
                            "itemTemplate": {
                              "type": "container",
                              "children": [
                                {
                                  "type": "text",
                                  "properties": {
                                    "value": "{{ item.action }}",
                                    "color": "{{ item.priority === 'high' ? '#ff6b6b' : '#ffffff' }}"
                                  }
                                },
                                {
                                  "type": "text",
                                  "properties": {
                                    "value": "{{ item.reason }}",
                                    "size": "small",
                                    "color": "#888"
                                  }
                                }
                              ]
                            }
                          }
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  "utils": {
    "formatCurrency": "function(value) { return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value) }",
    "calculateTrend": "function(data) { if (!data || data.length < 2) return 0; const current = data[data.length - 1].total_revenue; const previous = data[data.length - 2].total_revenue; return ((current - previous) / previous * 100).toFixed(1) + '%' }",
    "renderHealthScore": "function(client) { const score = client.health_score; const color = score >= 80 ? '#4ade80' : score >= 60 ? '#fbbf24' : '#ef4444'; return `<span style='color: ${color}; font-weight: bold'>${score}%</span>` }",
    "renderRiskBadges": "function(risks) { if (!risks || risks.length === 0) return '<span style=\"color: #4ade80\">Low Risk</span>'; return risks.map(risk => `<span class='risk-badge'>${risk}</span>`).join(' ') }",
    "formatDuration": "function(seconds) { const mins = Math.floor(seconds / 60); return `${mins}:${(seconds % 60).toString().padStart(2, '0')}` }",
    "generateActionItems": "function(clients, calls) { const actions = []; clients.filter(c => c.health_score < 70).forEach(c => { actions.push({ action: `Schedule check-in with ${c.name}`, reason: `Health score below 70% (${c.health_score}%)`, priority: 'high' }) }); return actions }",
    "refreshQueries": "function() { getClientHealth.trigger(); getRevenueMetrics.trigger(); getRecentCalls.trigger() }"
  },
  "state": {
    "chatMessages": {
      "initialValue": [],
      "persist": false
    },
    "selectedClient": {
      "initialValue": null,
      "persist": true
    },
    "dateRange": {
      "initialValue": {
        "start": "{{ moment().subtract(30, 'days').format('YYYY-MM-DD') }}",
        "end": "{{ moment().format('YYYY-MM-DD') }}"
      },
      "persist": true
    }
  },
  "styles": {
    "global": {
      "fontFamily": "'Inter', -apple-system, BlinkMacSystemFont, sans-serif",
      "backgroundColor": "#0f0f0f",
      "color": "#ffffff"
    },
    "components": {
      ".risk-badge": {
        "backgroundColor": "#ef4444",
        "color": "#ffffff",
        "padding": "2px 8px",
        "borderRadius": "4px",
        "fontSize": "12px",
        "marginRight": "4px"
      }
    }
  }
}
